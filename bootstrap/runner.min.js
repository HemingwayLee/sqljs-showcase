!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(s){"use strict";function i(e,t){clearTimeout(t.timeout),s.off(window,"mouseup",t.hurry),s.off(window,"keyup",t.hurry)}s.defineOption("autoRefresh",!1,function(e,t){function o(){n.display.wrapper.offsetHeight?(i(0,r),n.display.lastWrapHeight!=n.display.wrapper.clientHeight&&n.refresh()):r.timeout=setTimeout(o,r.delay)}var n,r;e.state.autoRefresh&&(i(0,e.state.autoRefresh),e.state.autoRefresh=null),t&&0==e.display.wrapper.offsetHeight&&((r=(n=e).state.autoRefresh={delay:t.delay||250}).timeout=setTimeout(o,r.delay),r.hurry=function(){clearTimeout(r.timeout),r.timeout=setTimeout(o,50)},s.on(window,"mouseup",r.hurry),s.on(window,"keyup",r.hurry))})});var theRunner=function(n){const r={"employees.sql":{title:"Test sql scripts",desc:"let's use this employees table"},"row2column.sql":{title:"Convert row to column",desc:"let's use this pitchers table to do row to column conversion"}};var e=document.getElementById("execute"),t=document.getElementById("output"),o=document.getElementById("error"),s=document.getElementById("commands"),i=new Worker("worker.sql-wasm.js");function a(e){console.log(e),o.style.height="2em",o.textContent=e.message}function l(e,r){i.onmessage=function(e){var t=e.data.results;if(console.log(t),t){r.innerHTML="";var o=document.createElement("div");o.className="tableFixHead",o.style.margin="8px";for(var n=0;n<t.length;n++)o.appendChild(function(e,t){var o=document.createElement("table");o.className="table table-striped";e="<thead>"+u(e,"th")+"</thead>",t=t.map(function(e){return u(e,"td")});return e+="<tbody>"+u(t,"tr")+"</tbody>",o.innerHTML=e,o}(t[n].columns,t[n].values));r.appendChild(o)}else a({message:e.data.error})},i.postMessage({action:"exec",sql:e}),r.textContent="Fetching results..."}function u(e,t){if(0===e.length)return"";var o="<"+t+">",t="</"+t+">";return o+e.join(t+o)+t}function c(o){var e=window.location.protocol+"//"+window.location.host+"/sql/"+o;n.ajax({type:"GET",url:e,success:function(e){n("#setup").val(e);var t=document.getElementById("setup");CodeMirror.fromTextArea(t,{mode:"text/x-mysql",autoRefresh:!0,viewportMargin:1/0,indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autofocus:!0}),l(e,document.getElementById("tables")),e=o,n("#title").html(r[e].title),n("#desc").html(r[e].desc)},error:function(e,t,o){console.log(`[${e.status}] ${e.responseText}`)}})}i.onerror=a,i.postMessage({action:"open"}),e.addEventListener("click",()=>{o.innerHTML="",l(d.getValue()+";",t)},!0);var d=CodeMirror.fromTextArea(s,{mode:"text/x-mysql",viewportMargin:1/0,indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autofocus:!0});n(document).ready(function(){var e;n("#toggle").on("click",function(){n(".sidenav").toggleClass("activeside"),n(".main").toggleClass("activemain"),n(".main").toggleClass("col-sm-6 col-sm-12"),n("#eyes").toggleClass("glyphicon glyphicon-eye-close glyphicon glyphicon-eye-open")}),(e=new URL(window.location.href).searchParams.get("file"))&&c(e)})}(jQuery);
